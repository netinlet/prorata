"use strict";angular.module("prorataApp",[]),angular.module("prorataApp").controller("MainCtrl",["$scope","Calculator",function(a,b){function c(a,b,c){if(c.prorataCalculation.effectiveDate&&c.prorataCalculation.termInMonths){var d=Date.create(c.prorataCalculation.effectiveDate);c.prorataCalculation.expirationDate=d.advance({months:c.prorataCalculation.termInMonths}).format("{yyyy}-{MM}-{dd}")}}a.prorataCalculation={termInMonths:12,factorMethod:"standard"},a.prorataResult={},a.recalculate=function(){console.log("Recalculate Called...");var c=Date.create(this.prorataCalculation.effectiveDate),d=Date.create(this.prorataCalculation.expirationDate),e=Date.create(this.prorataCalculation.cancellationDate);a.prorataResult=b.calculateProRata(c,d,e,this.prorataCalculation.premiumAmount,this.prorataCalculation.factorMethod)},a.$watch("prorataCalculation.effectiveDate",c),a.$watch("prorataCalculation.termInMonths",c)}]),angular.module("prorataApp").factory("Calculator",function(){return{oneDayInMilliSeconds:864e5,daysBetweenDates:function(a,b){return Math.round(Math.abs((b.getTime()-a.getTime())/this.oneDayInMilliSeconds))},isValidDate:function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},calculateProRata:function(a,b,c,d,e){var f,g,h,i=0;e=e||"standard",this.isValidDate(a)&&this.isValidDate(b)&&(f=this.daysBetweenDates(a,b)),this.isValidDate(a)&&this.isValidDate(b)&&this.isValidDate(c)&&(h=this.daysBetweenDates(a,c),g=f-h,i=parseFloat((g/f).toFixed(3)),"shortRate"===e&&(i=parseFloat(.9*i).toFixed(3)));var j=0,k=0;return d&&(k=(d*i).toFixed(2),j=(d-k).toFixed(2)),{earnedDays:h,unearnedDays:g,totalDays:f,prorataFactor:i,unearnedPremium:k,earnedPremium:j}}}});